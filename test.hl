// The core library for input/output in hail.

import core_option as option
import { CP_UTF8, GetStdHandle, SetConsoleOutputCP, STD_OUTPUT_HANDLE, WriteConsoleA } from win32

val putchar = shared routine(c <- char) {
    SetConsoleOutputCP(CP_UTF8) // enable utf8 on windows
    val utf8 = char::as_utf8(&c)
    val c_str = str::as_c_str(&utf8)
    val written = fluid (0 as uint64)
    WriteConsoleA(
        GetStdHandle(STD_OUTPUT_HANDLE),
        c_str,
        str::len(utf8),
        0,
    )
}

val print = shared routine(s <- str) {
    val chars = fluid str::chars(&s)
    val next_char = Chars::next(&chars)

    while true {
        match next_char {
            c <- some => {
                putchar(c)
            },
            _ <- none => {
                break
            }
        }
    }

    putchar("\n")
}

val println = shared routine(s <- str) {
    print(s)
    putchar("\n ")
}